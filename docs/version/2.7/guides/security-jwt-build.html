<!DOCTYPE html>
<html>





<head>
  <title>JSONウェブトークン (JWT) のビルド、署名、暗号化 - 2.7 - Quarkus</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Security-Policy" content="default-src https://dpm.demdex.net; script-src 'self' 'unsafe-eval' 'sha256-ANpuoVzuSex6VhqpYgsG25OHWVA1I+F6aGU04LoI+5s=' 'sha256-ipy9P/3rZZW06mTLAR0EnXvxSNcnfSDPLDuh3kzbB1w=' js.bizographics.com https://www.redhat.com https://static.redhat.com assets.adobedtm.com jsonip.com https://ajax.googleapis.com https://www.googletagmanager.com https://www.google-analytics.com https://use.fontawesome.com https://app.mailjet.com http://www.youtube.com http://www.googleadservices.com https://googleads.g.doubleclick.net https://dpm.demdex.net https://giscus.app; style-src 'self' https://fonts.googleapis.com https://use.fontawesome.com; img-src 'self' *; media-src 'self'; frame-src https://www.googletagmanager.com https://www.youtube.com https://embed.restream.io https://app.mailjet.com https://giscus.app; base-uri 'none'; object-src 'none'; form-action 'none'; font-src 'self' https://use.fontawesome.com https://fonts.gstatic.com;" />
  <script id="adobe_dtm" src="https://www.redhat.com/dtm.js" type="text/javascript"></script>
  <script src="/assets/javascript/highlight.pack.js" type="text/javascript"></script>
  <META HTTP-EQUIV='X-XSS-Protection' CONTENT="1; mode=block">
  <META HTTP-EQUIV='X-Content-Type-Options' CONTENT="nosniff">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Quarkus: Supersonic Subatomic Java">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@QuarkusIO"> 
  <meta name="twitter:creator" content="@QuarkusIO">
  <meta property="og:url" content="https://quarkus.io/version/2.7/guides/security-jwt-build" />
  <meta property="og:title" content="JSONウェブトークン (JWT) のビルド、署名、暗号化 - 2.7" />
  <meta property="og:description" content="Quarkus: Supersonic Subatomic Java" />
  <meta property="og:image" content="https://quarkus.io/assets/images/quarkus_card.png" />
  
  <link rel="canonical" href="https://quarkus.io/guides/security-jwt-build">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/guides/stylesheet/config.css" />
  <link rel="stylesheet" href="/assets/css/main.css?2021-07-29" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
  <link rel="alternate" type="application/rss+xml"  href="/feed.xml" title="Quarkus">
  <script src="/assets/javascript/goan.js" type="text/javascript"></script>
  <script src="/assets/javascript/hl.js" type="text/javascript"></script>
  
  
  
  
  <link rel="alternate" hreflang="en" href="https://quarkus.io/version/2.7/guides/security-jwt-build" />
  
  <link rel="alternate" hreflang="es" href="https://es.quarkus.io/version/2.7/guides/security-jwt-build" />
  
  <link rel="alternate" hreflang="zh" href="https://cn.quarkus.io/version/2.7/guides/security-jwt-build" />
  
  <link rel="alternate" hreflang="ja" href="https://ja.quarkus.io/version/2.7/guides/security-jwt-build" />
  
  <link rel="alternate" hreflang="x-default" href="https://quarkus.io/" />
</head>

<body class="guides">
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJWS5L"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  

<div class="grid-wrapper communitysite">
  <div class="grid__item width-12-12">The <a href="https://quarkus.io">English version of quarkus.io</a> is the official project site. Translated sites are community supported on a best-effort basis.</div>
</div>


  <div class="nav-wrapper">
  <div class="grid-wrapper">
    <div class="width-12-12">
      <input type="checkbox" id="checkbox" />
      <nav id="main-nav" class="main-nav">
  <div class="container">
    <div class="logo-wrapper">
        <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_600px_reverse.png" class="project-logo" title="Quarkus"></a>
    </div>
    <label class="nav-toggle" for="checkbox"> <i class="fa fa-bars"></i>
</label>
    <ul id="menu" class="menu">
      <li class="dropdown">
        <span href="/about/">Quarkusとは <i class="fas
fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/about" class="">QUARKUSとは何か?</a></li>
          <li><a href="/container-first" class="">コンテナ・ファースト</a></li>
          <li><a href="/continuum" class="">リアクティブ</a></li>
          <li><a href="/developer-joy" class="">開発者満足</a></li>
          <li><a href="/kubernetes-native" class="">KUBERNETES NATIVE</a></li>
          <li><a href="/standards" class="">標準</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="/learn/">学ぶ<i class="fas
fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/get-started" class="">入門</a></li>
          <li><a href="/guides" class="active">ガイド</a></li>
          <li><a href="/qtips" class="">"Q" Tipsビデオ</a></li>          
          <li><a href="/books" class="">書籍</a></li>
          </ul>
      </li>
      <li class="dropdown">
        <span href="/community/">コミュニティ <i class="fas
fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/support/" class="">サポート</a></li>
          <li><a href="/blog" class="">ブログ</a></li>
          <li><a href="/discussion" class="">ディスカッション</a></li>
          <li><a href="/insights" class="">ポッドキャスト</a></li>
          <li><a href="/events" class="">イベント</a></li>
          <li><a href="/newsletter" class="">ニュースレター</a></li>
          <li><a href="/publications" class="">出版物</a></li>
          <li><a href="/awards" class="">受賞</a></li>
          </ul>
      </li>
      <li>
        <a href="https://code.quarkus.io" class="button-cta secondary
white">コーディングを開始</a>
      </li>
      <li class="dropdown">
        <span href="/language/"><div class="fas fa-globe langicon"></div><i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="https://quarkus.io/version/2.7/guides/security-jwt-build" >OFFICIAL (ENGLISH)</a></li>
          <li><a href="https://es.quarkus.io/version/2.7/guides/security-jwt-build">ESPAÑOL</a></li>
          <li><a href="https://cn.quarkus.io/version/2.7/guides/security-jwt-build">简体中文</a></li>
          <li><a href="https://ja.quarkus.io/version/2.7/guides/security-jwt-build">日本語</a></li>
          </ul>
      </li>
    </ul>
  </div>
      </nav>
    </div>
  </div>
</div>

  <div class="content">
    



<div class="full-width-version-bg grey align-self">
  <div class="grid-wrapper">
    <div class="grid__item width-6-12">
      <p class="returnlink"><i class="fas fa-angle-left"></i><a href="/version/2.7/guides/">ガイド一覧に戻る</a></p>
    </div>
    <div class="grid__item width-6-12 align-self-center text-right hide-mobile">
      <label id="guide-version-label">ガイドのバージョンを選択</label>
      <select id="guide-version-dropdown">
        
      
        
        
        
        
          
        <option value="main" >Main - SNAPSHOT</option>
        
        
      
        
        
        
        
          
        <option value="latest" >2.12 - Latest</option>
        
        
      
        
        
        
        
          
        <option value="2.7" selected>2.7</option>
        
        
      
        
        
        
        
      
        
        
        
        
      
    
      </select>
    </div>
  </div>
</div>

<div class="grid-wrapper guide">
  <div class="grid__item width-12-12 width-12-12-mobile">
    <h1 class="text-caps">JSONウェブトークン (JWT) のビルド、署名、暗号化 </h1>
  </div>
  <div class="width-12-12">
    <div class="hide-mobile toc"><ul class="sectlevel1">
<li><a href="#依存関係">依存関係</a></li>
<li><a href="#create-jwtclaimsbuilder-and-set-the-claims">Create JwtClaimsBuilder and set the claims</a></li>
<li><a href="#sign-claims">クレームへの署名</a></li>
</ul></div>
    <div>
      <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://datatracker.ietf.org/doc/html/rfc7519">RFC7519</a> によると、JSON Web Token (JWT) は、使用される JSON オブジェクトとしてエンコードされたクレームを表すコンパクトで URL セーフな手段です。JSON Web Signature (JWS) 構造のペイロードとして、または JSON Web Encryption (JWE) 構造のプレーンテキストとして、クレームにデジタル署名したり、メッセージ認証コード (MAC) で完全に保護したり、暗号化したりできます。</p>
</div>
<div class="paragraph">
<p>クレームへの署名は、クレームを保護するために最も頻繁に使用されます。今日において JWT トークンとして知られているものは、通常、<a href="https://tools.ietf.org/html/rfc7515">JSON Web 署名</a> の仕様で説明されている手順を使用して、JSON 形式でクレームに署名することによって生成されます。</p>
</div>
<div class="paragraph">
<p>ただし、クレームが機密である場合は、<a href="https://tools.ietf.org/html/rfc7516">JSON Web 暗号化</a> の仕様に記載されている手順に従って暗号化されたクレームを含む JWT を生成することにより、機密性を保証できます。</p>
</div>
<div class="paragraph">
<p>Finally both the confidentiality and integrity of the claims can be further enforced by signing them first and then encrypting the nested JWT token.</p>
</div>
<div class="paragraph">
<p>SmallRye JWT Build は、これらすべてのオプションを使用して JWT クレームを保護するための API を提供します。<a href="https://bitbucket.org/b_c/jose4j/wiki/Home">Jose4J</a> は、この API をサポートするために内部で使用されます。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="依存関係"><a class="anchor" href="#依存関係"></a>依存関係</h2>
<div class="sectionbody">
<div class="listingblock primary asciidoc-tabs-target-sync-cli asciidoc-tabs-target-sync-maven">
<div class="title">pom.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
    &lt;artifactId&gt;&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-target-sync-gradle">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-gradle hljs" data-lang="gradle">implementation("io.quarkus:quarkus-smallrye-jwt-build")</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>quarkus-smallrye-jwt</code> でサポートされている MicroProfile JWT エンドポイントを作成しなくても、Smallrye JWT Build API を使用できることに留意してください。MP JWT エンドポイントが JWT トークンを生成する必要がない場合は、<code>quarkus-smallrye-jwt</code> から除外することもできます。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="create-jwtclaimsbuilder-and-set-the-claims"><a class="anchor" href="#create-jwtclaimsbuilder-and-set-the-claims"></a>Create JwtClaimsBuilder and set the claims</h2>
<div class="sectionbody">
<div class="paragraph">
<p>最初のステップとして、以下のオプションの 1 つを使用して <code>JwtClaimsBuilder</code> を初期化し、それにいくつかのクレームを追加します:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import java.util.Collections;
import javax.json.Json;
import javax.json.JsonObject;
import io.smallrye.jwt.build.Jwt;
import io.smallrye.jwt.build.JwtClaimsBuilder;
import org.eclipse.microprofile.jwt.JsonWebToken;
...
// Create an empty builder and add some claims
JwtClaimsBuilder builder1 = Jwt.claims();
builder1.claim("customClaim", "custom-value").issuer("https://issuer.org");
// Or start typing the claims immediately:
// JwtClaimsBuilder builder1 = Jwt.upn("Alice");

// Builder created from the existing claims
JwtClaimsBuilder builder2 = Jwt.claims("/tokenClaims.json");

// Builder created from a map of claims
JwtClaimsBuilder builder3 = Jwt.claims(Collections.singletonMap("customClaim", "custom-value"));

// Builder created from JsonObject
JsonObject userName = Json.createObjectBuilder().add("username", "Alice").build();
JsonObject userAddress = Json.createObjectBuilder().add("city", "someCity").add("street", "someStreet").build();
JsonObject json = Json.createObjectBuilder(userName).add("address", userAddress).build();
JwtClaimsBuilder builder4 = Jwt.claims(json);

// Builder created from JsonWebToken
@Inject JsonWebToken token;
JwtClaimsBuilder builder5 = Jwt.claims(token);</code></pre>
</div>
</div>
<div class="paragraph">
<p>これは fluent API であるため、ビルダーの初期化は fluent API シーケンスの一部として実行できます。</p>
</div>
<div class="paragraph">
<p>ビルダーは、<code>iat</code> (発行日) を現在の時刻に設定し、<code>exp</code> (有効期限) を現在の時刻から 5 分後に設定し (<code>smallrye.jwt.new-token.lifespan</code> プロパティーでカスタマイズ可能)、未設定の場合は <code>jti</code> (一意のトークン識別子) クレームも設定します。</p>
</div>
<div class="paragraph">
<p><code>smallrye.jwt.new-token.issuer</code> プロパティーと <code>smallrye.jwt.new-token.audience</code> プロパティーを設定し、ビルダー API を使用した発行者とオーディエンスの直接設定を省略することもできます。</p>
</div>
<div class="paragraph">
<p>次のステップでは、クレームの保護方法を決定します。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sign-claims"><a class="anchor" href="#sign-claims"></a>クレームへの署名</h2>
<div class="sectionbody">
<div class="paragraph">
<p>クレームは、すぐに署名するか、 `JSON Web Signature ` ヘッダーが設定された後に署名できます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.smallrye.jwt.build.Jwt;
...

// Sign the claims using an RSA private key loaded from the location set with a 'smallrye.jwt.sign.key.location' property.
// No 'jws()' transition is necessary. Default algorithm is RS256.
String jwt1 = Jwt.claims("/tokenClaims.json").sign();

// Set the headers and sign the claims with an RSA private key loaded in the code (the implementation of this method is omitted).
// Note a 'jws()' transition to a 'JwtSignatureBuilder', Default algorithm is RS256.
String jwt2 = Jwt.claims("/tokenClaims.json").jws().keyId("kid1").header("custom-header", "custom-value").sign(getPrivateKey());</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>alg</code> (アルゴリズム) ヘッダーはデフォルトで <code>RS256</code> に設定されていることに注意してください。 <code>kid</code> プロパティーを含む単一の JSON Web Key (JWK) を使用する場合、署名キー識別子 ( <code>kid</code> ヘッダー) を設定する必要はありません。</p>
</div>
<div class="paragraph">
<p>RSA and Elliptic Curve (EC) private keys as well as symmetric secret keys can be used to sign the claims. <code>ES256</code> and <code>HS256</code> are the defaut algorithms for EC private and symmetric key algorithms respectively.</p>
</div>
<div class="paragraph">
<p>署名アルゴリズムはカスタマイズできます。以下はその例です。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.smallrye.jwt.SignatureAlgorithm;
import io.smallrye.jwt.build.Jwt;

// Sign the claims using an RSA private key loaded from the location set with a 'smallrye.jwt.sign.key.location' property. Algorithm is PS256.
String jwt = Jwt.upn("Alice").jws().algorithm(SignatureAlgorithm.PS256).sign();</code></pre>
</div>
</div>
<div class="paragraph">
<p>または、 <code>smallrye.jwt.new-token.signature-algorithm</code> プロパティーを使用することもできます:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties smallrye.jwt.new-token.signature-algorithm=PS256 ``` hljs" data-lang="properties smallrye.jwt.new-token.signature-algorithm=PS256 ```">より単純な API シーケンスを記述します。

[source, java]
----
import io.smallrye.jwt.build.Jwt;

// Sign the claims using an RSA private key loaded from the location set with a 'smallrye.jwt.sign.key.location' property. Algorithm is PS256.
String jwt = Jwt.upn("Alice").sign();
----

`sign` ステップは、&lt;&lt;encrypt-claims, encrypt&gt;&gt; ステップと組み合わせて `inner-signed and encrypted` を生成することもできることに注意してください。詳細は、&lt;&lt;innersign-encrypt-claims, クレームへの署名とネストされた JWT トークンの暗号化&gt;&gt; セクションを参照してください。

[[encrypt-claims]]
== クレームの暗号化

クレームは、すぐに暗号化することも、 `JSON Web Encryption` ヘッダーを署名するのと同じ方法で設定した後に暗号化することもできます。唯一の小さな違いは、API がクレームの署名と内部署名をサポートするように最適化されている場合、クレームの暗号化には常に `jwe()` `JwtEncryptionBuilder` 遷移が必要になることです。

[source, java]
----
import io.smallrye.jwt.build.Jwt;
...

// Encrypt the claims using an RSA public key loaded from the location set with a 'smallrye.jwt.encrypt.key.location' property. Default key encryption algorithm is RSA-OAEP.
String jwt1 = Jwt.claims("/tokenClaims.json").jwe().encrypt();

// Set the headers and encrypt the claims with an RSA public key loaded in the code (the implementation of this method is omitted).  Default key encryption algorithm is A256KW.
String jwt2 = Jwt.claims("/tokenClaims.json").jwe().header("custom-header", "custom-value").encrypt(getSecretKey());
----

デフォルトでは、`alg` (キー管理アルゴリズム) ヘッダーが `RSA-OAEP` に設定され、`enc` (コンテンツ暗号化ヘッダー) が `A256GCM` に設定されていることに注意してください。

RSA and Elliptic Curve (EC) public keys as well as symmetric secret keys can be used to encrypt the claims. `ECDH-ES` and `A256KW` are the defaut algorithms for EC public and symmetric key encryption algorithms respectively.

Note two encryption operations are done when creating an ecrypted token:

1) 生成されたコンテンツ暗号化キーは、`RSA-OAEP` などのキー暗号化アルゴリズムを使用して API で提供されるキーによって暗号化されます
2) the claims are encryped by the generated content encryption key using the content encryption algorithm such as `A256GCM`.

キーとコンテンツの暗号化アルゴリズムはカスタマイズできます。以下はその例です。

[source, java]
----
import io.smallrye.jwt.KeyEncryptionAlgorithm;
import io.smallrye.jwt.ContentEncryptionAlgorithm;
import io.smallrye.jwt.build.Jwt;

// Encrypt the claims using an RSA public key loaded from the location set with a 'smallrye.jwt.encrypt.key.location' property.
// Key encryption algorithm is RSA-OAEP-256, content encryption algorithm is A256CBC-HS512.
String jwt = Jwt.subject("Bob").jwe()
    .keyAlgorithm(KeyEncryptionAlgorithm.RSA_OAEP_256)
    .contentAlgorithm(ContentEncryptionAlgorithm.A256CBC_HS512)
    .encrypt();
----

また、 `smallrye.jwt.new-token.key-encryption-algorithm` と `smallrye.jwt.new-token.content-encryption-algorithm` のプロパティでキーとコンテンツの暗号化アルゴリズムをカスタマイズすることが可能です。

```properties smallrye.jwt.new-token.key-encryption-algorithm=RSA-OAEP-256 smallrye.jwt.new-token.content-encryption-algorithm=A256CBC-HS512 ```

より単純な API シーケンスを記述します。

[source, java]
----
import io.smallrye.jwt.build.Jwt;

// Encrypt the claims using an RSA public key loaded from the location set with a 'smallrye.jwt.encrypt.key.location' property.
// Key encryption algorithm is RSA-OAEP-256, content encryption algorithm is A256CBC-HS512.
String jwt = Jwt.subject("Bob").encrypt();
----

Note that when the token is directly encrypted by the public RSA or EC key it is not possible to verify which party sent the token. Therefore the secret keys should be preferred for directly encrypting the tokens, for example, when using JWT as cookies where a secret key is managed by the Quarkus endpoint with only this endpoint being both a producer and a consumer of the encrypted token.

RSA または EC 公開鍵を使用してトークンを暗号化する場合、署名鍵が使用可能であれば最初にトークンに署名することをお勧めします。詳細については、次の&lt;&lt;innersign-encrypt-claims, クレームへの署名とネストされた JWT トークンの暗号化&gt;&gt; セクションを参照してください。

[[innersign-encrypt-claims]]
== クレームへの署名とネストされた JWT トークンの暗号化

クレームに署名してから、署名と暗号化の手順を組み合わせて、ネストされた JWT トークンを暗号化できます。
[source, java]
----
import io.smallrye.jwt.build.Jwt;
...

// Sign the claims and encrypt the nested token using the private and public keys loaded from the locations set with the 'smallrye.jwt.sign.key.location' and 'smallrye.jwt.encrypt.key.location' properties respectively. Signature algorithm is RS256, key encryption algorithm is RSA-OAEP-256.
String jwt = Jwt.claims("/tokenClaims.json").innerSign().encrypt();
----

== Fast JWT Generation

`smallrye.jwt.sign.key.location` や `smallrye.jwt.encrypt.key.location` プロパティーが設定されている場合、既存のクレーム (リソース、マップ、JsonObjects) を 1 回の呼び出しで保護できます。

[source, java]
----
// More compact than Jwt.claims("/claims.json").sign();
Jwt.sign("/claims.json");

// More compact than Jwt.claims("/claims.json").jwe().encrypt();
Jwt.encrypt("/claims.json");

// More compact than Jwt.claims("/claims.json").innerSign().encrypt();
Jwt.signAndEncrypt("/claims.json");
----
上記のように、必要に応じて、 `iat` (発行日)、 `exp` (有効期限)、 `jti` (トークン識別子)、 `iss` (発行者)、および `aud` (オーディエンス) クレームが追加されます。

== キーの取り扱い

`smallrye.jwt.sign.key.location` プロパティーと `smallrye.jwt.encrypt.key.location` プロパティーを使用して、署名キーと暗号化キーの場所を指定できます。キーは、ローカルファイルシステムやクラスパスに配置するか、リモートエンドポイントから取得でき、 `PEM` または `JSON Web Key` ( `JWK` ) 形式にすることができます。以下はその例です。

[source, properties]
----
smallrye.jwt.sign.key=privateKey.pem
smallrye.jwt.encrypt.key=publicKey.pem
----

MicroProfile `ConfigSource` を使用して、link:{vault-guide}[HashiCorp Vault] や他のシークレットマネージャーなどの外部サービスからキーを取得し、代わりに `smallrye.jwt.sign.key` プロパティーと `smallrye.jwt.encrypt.key` プロパティーを使用することもできます。

[source, properties]
----
smallrye.jwt.sign.key=${private.key.from.vault}
smallrye.jwt.encrypt.key=${public.key.from.vault}
----

この場合、`private.key.from.vault` と `public.key.from.vault` はどちらも、カスタムの `ConfigSource` によって提供される `PEM` または `JWK` 形式のキー値です。`smallrye.jwt.sign.key` と `smallrye.jwt.encrypt.key` には、Base64 でエンコードされた秘密鍵または公開鍵の値のみ含めることができます。

ただし、設定に秘密鍵を直接インライン化することはお勧めしません。リモートシークレットマネージャーから署名キー値を取得する必要がある場合にのみ、`smallrye.jwt.sign.key` プロパティーを使用してください。

キーは、JWT ビルド API に提供される、トークンをビルドするコードによってロードすることもできます。

対称秘密鍵を使用してトークンに署名および/または暗号化する必要がある場合は、`io.smallrye.jwt.util.KeyUtils` を使用して必要な長さの秘密鍵を生成することを検討してください。

たとえば、`HS512` アルゴリズム (`512/8`) を使用して署名するには 64 バイトのキーが必要であり、`A256KW` アルゴリズム (`256/8`) を使用してコンテンツ暗号化キーを暗号化するには 32 バイトのキーが必要です。

[source, java]
----
import javax.crypto.SecretKey;
import io.smallrye.jwt.KeyEncryptionAlgorithm;
import io.smallrye.jwt.SignatureAlgorithm;
import io.smallrye.jwt.build.Jwt;
import io.smallrye.jwt.util.KeyUtils;

SecretKey signingKey = KeyUtils.generateSecretKey(SignatureAlgorithm.HS512);
SecretKey encryptionKey = KeyUtils.generateSecretKey(KeyEncryptionAlgorithm.A256KW);
String jwt = Jwt.claim("sensitiveClaim", getSensitiveClaim()).innerSign(signingKey).encrypt(encryptionKey);
----

また、`JSON Web Key` (JWK) または `JSON Web Key Set` (JWK Set) 形式を使用して秘密鍵を安全なファイルシステムに保存し、 `smallrye.jwt.sign.key.location` または `smallrye.jwt.encrypt.key.location` プロパティーを使用してそれを参照する方法もあります。以下はその例です。

[source, json]
----
{
 "kty":"oct",
 "kid":"secretKey",
 "k":"Fdh9u8rINxfivbrianbbVT1u232VQBZYKx1HGAGPt2I"
}
----

or

[source, json]
----
{
 "keys": [
   {
     "kty":"oct",
     "kid":"secretKey1",
     "k":"Fdh9u8rINxfivbrianbbVT1u232VQBZYKx1HGAGPt2I"
   },
   {
     "kty":"oct",
     "kid":"secretKey2",
     "k":"AyM1SysPpbyDfgZld3umj1qzKObwVMkoqQ-EstJQLr_T-1qS0gZH75aKtMN3Yj0iPS4hcgUuTwjAzZr1Z9CAow"
   }
 ]
}
----

`io.smallrye.jwt.util.KeyUtils` can also be used to generate a pair of assymetric RSA or EC keys. These keys can be stored using a `JWK`, `JWK Set` or `PEM` format.

== SmallRye JWT Builder configuration

SmallRye JWT は、クレームの署名や暗号化の方法をカスタマイズするために使用できる次のプロパティーをサポートしています。

[cols="&lt;m,&lt;m,&lt;2", options="header"]
|===
|プロパティ名e|デフォルト|説明
|smallrye.jwt.sign.key.location|`none`|引数なし `sign()` または `innerSign()` メソッドが呼び出されたときに、クレームに署名するために使用される秘密鍵の場所。
|smallrye.jwt.sign.key|none|引数なし `sign()` または `innerSign()` メソッドが呼び出されたときに、クレームに署名するために使用されるキー値。
|smallrye.jwt.sign.key.id|`none`|JWK キーを使用する場合にのみチェックされる署名キー識別子。
|smallrye.jwt.encrypt.key.location|`none`|引数無し `encrypt()` メソッドが呼び出された際に、クレームまたは内部 JWT を暗号化するために使用される公開鍵の位置。
|smallrye.jwt.sign.relax-key-validation|false|署名キーの検証を緩和します。
|smallrye.jwt.encrypt.key|none|引数なし `encrypt()` メソッドが呼び出された際に、クレームまたは内部 JWT を暗号化するために使用されるキー値。
|smallrye.jwt.encrypt.key.id|`none`|JWK キーを使用する場合にのみチェックされる暗号化キー識別子。
|smallrye.jwt.encrypt.relax-key-validation|false|暗号化キーの検証を緩和します。
|smallrye.jwt.new-token.signature-algorithm|RS256|署名アルゴリズム。このプロパティーは、JWT 署名ビルダーが署名アルゴリズムをまだ設定していない場合にチェックされます。
|smallrye.jwt.new-token.key-encryption-algorithm|RSA-OAEP|キー暗号化アルゴリズム。このプロパティーは、JWT 暗号化ビルダーがキー暗号化アルゴリズムをまだ設定していない場合にチェックされます。
|smallrye.jwt.new-token.content-encryption-algorithm|A256GCM|コンテンツ暗号化アルゴリズム。このプロパティーは、JWT 暗号化ビルダーがコンテンツ暗号化アルゴリズムをまだ設定していない場合にチェックされます。
|smallrye.jwt.new-token.lifespan|300|exp (expiry) クレームがまだ設定されていない場合、このクレーム値を計算するために使用される トークン生存期間の秒数。
|smallrye.jwt.new-token.issuer|none|`iss` (発行者)クレームがまだ設定されていない場合に、このクレーム値を設定するために使用できるトークン発行者。
|smallrye.jwt.new-token.audience|none|`aud` (オーディエンス) クレームがまだ設定されていない場合に、このクレーム値を設定するために使用できるトークンオーディエンス。
|smallrye.jwt.new-token.override-matching-claims|false| 既に初期化されている `iss` （発行者）と `aud` （視聴者）のクレームを `smallrye.jwt.new-token.issuer` と `smallrye.jwt.new-token.audience` の値で上書きするために、 このプロパティを `true` に設定します。
|===

== 参照

* link:https://github.com/smallrye/smallrye-jwt[SmallRye JWT]
* link:https://tools.ietf.org/html/rfc7519[JSON Web Token]
* link:https://tools.ietf.org/html/rfc7515[JSON Web Signature]
* link:https://tools.ietf.org/html/rfc7516[JSON Web Encryption]
* link:https://tools.ietf.org/html/rfc7518[JSON Web Algorithms]
* link:https://bitbucket.org/b_c/jose4j/wiki/Home[Jose4J]
* xref:security-openid-connect.adoc[Using OpenID Connect to Protect Service Applications]
* xref:security-jwt.adoc[Using Smallrye JWT to Protect Service Applications]
* xref:security.adoc[Quarkus Security]</code></pre>
</div>
</div>
</div>
</div>
    </div>
  </div>
</div>

  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_reverse.svg" class="project-logo" title="Quarkus"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">Quarkus はオープンです。このプロジェクトの全ての依存関係は<a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Apache Software License 2.0</a>または互換性のあるライセンスの元で利用出来ます。<br /><br />このウェブサイトは <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a> で構築されており、<a href='https://pages.github.com/' target='_blank'>Github Pages</a>にホストされており、完全にオープンソースです。改善したい場合、 <a href='https://github.com/quarkusio/quarkusio.github.io' target='_blank'>ウェブサイトをフォークし</a>、修正してみせてください。</p>

    
      <div class="width-1-12 project-links">
        <span>ナビゲーション</span>
        <ul class="footer-links">
          
            <li><a href="/">ホーム</a></li>
          
            <li><a href="/about">Quarkusについて</a></li>
          
            <li><a href="/blog">ブログ</a></li>
          
            <li><a href="/insights">ポッドキャスト</a></li>
          
            <li><a href="/events">イベント</a></li>
          
            <li><a href="/newsletter">ニュースレター</a></li>
          
            <li><a href="/publications">出版</a></li>
          
            <li><a href="/awards">受賞</a></li>
          
            <li><a href="/security">セキュリティポリシー</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>フォロー</span>
        <ul class="footer-links">
          
            <li><a href="https://twitter.com/quarkusio">Twitter</a></li>
          
            <li><a href="https://www.facebook.com/quarkusio">Facebook</a></li>
          
            <li><a href="https://www.linkedin.com/company/quarkusio/">Linkedin</a></li>
          
            <li><a href="https://www.youtube.com/channel/UCaW8QG_QoIk_FnjLgr5eOqg">Youtube</a></li>
          
            <li><a href="https://github.com/quarkusio">GitHub</a></li>
          
        </ul>
      </div>
    
      <div class="width-2-12 project-links">
        <span>ヘルプ</span>
        <ul class="footer-links">
          
            <li><a href="/support">サポート</a></li>
          
            <li><a href="/guides">ガイド</a></li>
          
            <li><a href="/faq">FAQ</a></li>
          
            <li><a href="/get-started">入門</a></li>
          
            <li><a href="https://stackoverflow.com/questions/tagged/quarkus">Stack Overflow</a></li>
          
            <li><a href="https://github.com/quarkusio/quarkus/discussions">ディスカッション</a></li>
          
            <li><a href="https://groups.google.com/forum/#!forum/quarkus-dev">開発メーリングリスト</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>言語</span>
        <ul class="footer-links">
          
            <li><a href="https://quarkus.io/">English</a></li>
          
            <li><a href="https://es.quarkus.io/">Español</a></li>
          
            <li><a href="https://cn.quarkus.io/">简体中文</a></li>
          
            <li><a href="https://ja.quarkus.io/">日本語</a></li>
          
        </ul>
      </div>
    

    
      <div class="width-4-12 more-links">
        <span>Quarkusはコミュニティプロジェクトで構成されています：</span>
        <ul class="footer-links">
          
            <li><a href="https://vertx.io/" target="_blank">Eclipse Vert.x</a></li>
          
            <li><a href="https://smallrye.io" target="_blank">SmallRye</a></li>
          
            <li><a href="https://hibernate.org" target="_blank">Hibernate</a></li>
          
            <li><a href="https://netty.io" target="_blank">Netty</a></li>
          
            <li><a href="https://resteasy.github.io" target="_blank">RESTEasy</a></li>
          
            <li><a href="https://camel.apache.org" target="_blank">Apache Camel</a></li>
          
            <li><a href="https://microprofile.io" target="_blank">Eclipse MicroProfile</a></li>
          
            <li><a href="https://code.quarkus.io/" target="_blank">等々...</a></li>
          
        </ul>
      </div>
    
  </div>
</div>

  <div class="content redhat-footer">
  <div class="grid-wrapper">
    <span class="licence">
      <i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i> <a href="https://creativecommons.org/licenses/by/3.0/" target="_blank">CC by 3.0</a> | <a href="https://www.redhat.com/en/about/privacy-policy">Privacy Policy</a>
    </span>
    <span class="redhat">
      Sponsored by
    </span>
    <span class="redhat-logo">
      <a href="https://www.redhat.com/" target="_blank"><img src="/assets/images/redhat_reversed.svg"></a>
    </span>
  </div>
</div>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" integrity="sha384-8gBf6Y4YYq7Jx97PIqmTwLPin4hxIzQw5aDmUg/DDhul9fFpbbLcLh3nTIIDJKhx" crossorigin="anonymous"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/scroll-down.js"></script>
  <script src="/assets/javascript/satellite.js" type="text/javascript"></script>
  <script src="/guides/javascript/config.js" type="text/javascript"></script>
  <script src="/assets/javascript/search-filter.js" type="text/javascript"></script>
  <script src="/assets/javascript/guides-version-dropdown.js" type="text/javascript"></script>
  <script src="/assets/javascript/back-to-top.js" type="text/javascript"></script>
  <script src="/assets/javascript/clipboard.min.js" type="text/javascript"></script>
  <script src="/assets/javascript/copy.js" type="text/javascript"></script>
  <script src="/assets/javascript/asciidoc-tabs.js" type="text/javascript"></script>
</body>

</html>
